<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DDM → ForeFlight Converter (NO-SW TEST)</title>
  <meta name="theme-color" content="#0b3d91">
  <style>
    :root { --bg:#ffffff; --text:#111; --muted:#666; --accent:#0b3d91; --border:#e5e7eb; --card:#fafafa; }
    html, body {height:100%}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;background:var(--bg);color:var(--text);line-height:1.35}
    header{padding:28px 16px 8px}
    h1{margin:0 0 6px;font-size:28px;font-weight:800;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:14px}
    .container{padding:8px 16px 32px;max-width:820px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px}
    textarea,input[type="text"]{width:100%;box-sizing:border-box;padding:12px;border-radius:10px;border:1px solid var(--border);font-size:16px;background:#fff}
    textarea{min-height:140px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1}
    .btn{appearance:none;border:1px solid var(--border);border-radius:10px;background:#fff;padding:12px 14px;font-size:16px;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .out{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;background:#fff;border-radius:10px;border:1px solid var(--border);padding:12px;font-size:16px;min-height:48px;display:flex;align-items:center;justify-content:space-between;gap:8px;white-space:pre-wrap}
    .pill{display:inline-block;background:#eef2ff;color:#1e3a8a;border:1px solid #c7d2fe;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}
    .hint{color:var(--muted);font-size:13px}
    .examples{margin-top:10px}
    .examples code{background:#11111108;padding:3px 6px;border-radius:6px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace}
    .footer{color:var(--muted);font-size:12px;margin-top:24px}
  </style>
</head>
<body>
  <header>
    <h1>DDM → ForeFlight Converter <span class="pill">NO-SW TEST</span></h1>
    <div class="sub">This page has <strong>no service worker</strong> at all. If this works, the problem was caching.</div>
  </header>

  <div class="container">
    <div class="card">
      <label for="in" class="hint">Input (any format). One point per line or separated by commas.</label>
      <textarea id="in" placeholder="Example: 47.6205, -122.3493"></textarea>

      <div class="row" style="margin-top:10px">
        <button id="convert" class="btn primary" type="button">Convert</button>
        <button id="clear" class="btn" type="button">Clear</button>
        <button id="copy" class="btn" type="button">Copy Output</button>
      </div>

      <div style="margin-top:12px">
        <div class="hint">Output (ForeFlight DDM):</div>
        <div class="out"><span id="out"></span><span id="status" class="hint"></span></div>
      </div>
    </div>
  </div>

  <!-- No service worker registration on this page -->

  <script>
    function $(id){ return document.getElementById(id); }
    function status(msg){ $('status').textContent = msg || ''; }

    document.addEventListener('DOMContentLoaded', () => {
      const inEl = $('in');
      const outEl = $('out');

      $('convert').addEventListener('click', () => {
        const raw = (inEl.value || '').trim();
        if (!raw) { outEl.textContent = ''; status(''); return; }
        const res = convertMulti(raw);
        outEl.textContent = res.text;
        status(res.note);
      });

      $('clear').addEventListener('click', () => {
        inEl.value = '';
        outEl.textContent = '';
        status('Cleared.');
      });

      $('copy').addEventListener('click', async () => {
        const text = (outEl.textContent || '').trim();
        if (!text) return status('Nothing to copy.');
        try { await navigator.clipboard.writeText(text); status('Copied.'); }
        catch { status('Copy failed.'); }
      });
    });

    // Minimal conversion: supports DD, DDM, DMS
    function convertMulti(raw){
      const lines = raw.split(/\\n+/).map(s => s.trim()).filter(Boolean);
      const outputs = [];
      for (const line of lines) {
        const pair = splitLatLon(line);
        if (!pair) { outputs.push('⚠️ Could not detect lat/lon in: ' + line); continue; }
        const lat = parseAny(pair.lat);
        const lon = parseAny(pair.lon);
        if (!isFinite(lat) || !isFinite(lon)) { outputs.push('⚠️ Could not parse: ' + line); continue; }
        outputs.push(toDDM(lat, lon));
      }
      return { text: outputs.join('\\n'), note: outputs.length > 1 ? (outputs.length + ' lines converted') : 'Ready' };
    }

    function splitLatLon(line){
      const comma = line.split(/,(?![^()]*\\))/).map(s => s.trim()).filter(Boolean);
      if (comma.length === 2) return { lat: comma[0], lon: comma[1] };
      const groups = line.match(/([+\\-NSWE\\s]*\\d+(?:[\\.,]\\d+)?(?:[^\\d\\w]+\\d+(?:[\\.,]\\d+)?(?:[^\\d\\w]+\\d+(?:[\\.,]\\d+)?)?)?\\s*[NSWE]?)/gi);
      if (groups && groups.length >= 2) return { lat: groups[0], lon: groups[1] };
      const latCard = line.match(/([NS]\\s*[^NSEW,]+\\d[^NSEW,]*\\s*[NS]?)/i);
      const lonCard = line.match(/([EW]\\s*[^NSEW,]+\\d[^NSEW,]*\\s*[EW]?)/i);
      if (latCard && lonCard) return { lat: latCard[1], lon: lonCard[1] };
      return null;
    }

    function parseAny(str){
      let s = String(str).trim().toUpperCase();
      let hemi = (s.match(/[NSEW]/g) || []).slice(-1)[0] || null;
      s = s.replace(/[NSEW]/g, ' ').replace(/[°º]/g, ' ').replace(/[′’']/g, ' ').replace(/[″”"]/g, ' ');
      s = s.replace(/,/g, '.').replace(/\\s+/g, ' ').trim();
      const parts = s.split(' ').filter(Boolean).map(Number).filter(v => !Number.isNaN(v));
      let dd = null;
      if (parts.length === 1) dd = parts[0];
      else if (parts.length === 2) dd = parts[0] + parts[1] / 60;
      else if (parts.length >= 3) dd = parts[0] + parts[1] / 60 + parts[2] / 3600;
      if (hemi === 'S' || hemi === 'W') dd = -Math.abs(dd);
      return dd;
    }

    function toDDM(lat, lon){
      const latDDM = ddToDDM(Math.abs(lat), true);
      const lonDDM = ddToDDM(Math.abs(lon), false);
      const latH = lat >= 0 ? 'N' : 'S';
      const lonH = lon >= 0 ? 'E' : 'W';
      return `${latDDM} ${latH}  ${lonDDM} ${lonH}`;
    }
    function ddToDDM(dd, isLat){
      const deg = Math.floor(dd);
      const min = (dd - deg) * 60;
      const d = isLat ? String(deg).padStart(2, '0') : String(deg).padStart(3, '0');
      return `${d}° ${min.toFixed(3)}'`;
    }
  </script>
</body>
</html>
